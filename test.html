<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
		<script src='tilelevel2.js'></script>
		<style>
			.onecm1 {background-color: #557799;width:1cm; height:1cm;}			
			.test1 {background-color: #4fe;width:480px; height:550px; overflow: scroll;}		
			.levelSVG {width:300px; height:400px; border-style:solid; border-color:#00f; border-width:1px;}
			.spectrum41 {
				background:
					linear-gradient(#00f, transparent),
					linear-gradient(to top left, #0f0, transparent),
					linear-gradient(to top right, #f00, transparent);
				background-blend-mode: screen;
				}
			.bgRect {fill: #cc7799;}
			.bgBlur1 {fill: #998833;filter: url(#pictureFilter);}
			.cell {fill: #337766;}
		</style>
	</head>
	<body>
		<h1>Test v1.09</h1>
		<p id='stat' >State</p>
		<p>
			<a href='#' onclick='reset();'>reset</a>
		</p>
		<!--
		<div class='onecm'></div>
		<div class='test'-->
			<svg id="contentSVG" class='levelSVG' viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
				<!--
				<filter id="pictureFilter" >
					<feGaussianBlur stdDeviation="5" />
				</filter>
				-->
				<g id='maingroup'>
					
						<rect id='rb' class='bgRect' x="0px" y="0px" width="70cm" height="90cm"/>
						<ellipse cx="10cm" cy="20cm" rx="10cm" ry="20cm" style="fill:#639;" />
						<ellipse cx="15cm" cy="10cm" rx="15cm" ry="10cm" style="fill:#9fc;" />
						
						
						<rect id='r2'; x="1cm" y="1cm" width="1cm" height="1cm" style="fill:#9a1" />
						<rect id='r3'; x="2cm" y="2cm" width="1cm" height="1cm" class='bgBlur'/>
						<g>
							<ellipse id='bgell' cx="5cm" cy="3cm" rx="2.5cm" ry="1.5cm" style="fill:#963;"  onclick='clicked2(event);'  ontouchend='clicked2(event);'/>
							<rect id='r3'; x="3cm" y="3cm" width="1cm" height="1cm" style="fill:#f49" onclick='clicked(event);' ontouchend='clicked(event);'/>						
							
						</g>
						<rect id='rctn'; x="0px" y="0px" width="1cm" height="1cm" style="fill:rgba(255,0,0,0.2)" />
					
				</g>
				<g id='no'><text x="20" y="35" class="small">Myaer aer aer ar arbv </text></g>
			</svg>
			<!--
		</div>
		-->
		<script>
			console.log('start');
			var levelEngine = new LevelEngine(document.getElementById('contentSVG'), document.getElementById('maingroup'));
			levelEngine.innerWidth = 70 * levelEngine.tapSize;
			levelEngine.innerHeight = 90 * levelEngine.tapSize;
			//reset();
			levelEngine.applyZoomPosition();
			//console.log(document.getElementById('maingroup'));
			/*console.log('window.devicePixelRatio', window.devicePixelRatio);
			console.log('test');
			var rctn = document.getElementById("rctn");
			var tbb = rctn.getBBox();
			console.log(tbb);*/
			/*bgell.setAttributeNS(null, 'cx', '2.5cm');
			bgell.setAttributeNS(null, 'rx', '1.75cm');
			tbb = bgell.getBBox();
			console.log(tbb);*/
			function clicked(e) {
				e.stopPropagation();
				if (levelEngine.clicked) {
					document.getElementById('stat').innerText = 'one clicked ' + (new Date());
					console.log('1', levelEngine.clickX * levelEngine.translateZ, levelEngine.clickY * levelEngine.translateZ);
				}
			}
			function clicked2(e) {
				e.stopPropagation();
				//alert('two click');
				if (levelEngine.clicked) {
					document.getElementById('stat').innerText = 'two clicked ' + (new Date());
					console.log('2', levelEngine.clickX * levelEngine.translateZ, levelEngine.clickY * levelEngine.translateZ);
				}
			}
			function reset() {
				//var tbb = document.getElementById('contentSVG').getBBox();
				//console.log(tbb);
				//levelEngine.translateX=0;
				//levelEngine.translateY=0;
				//levelEngine.translateZ=1;
				//levelEngine.left = 0;
				//levelEngine.top = 0;
				//levelEngine.width = 600;
				//levelEngine.height = 400;
				//levelEngine.zoom = 1;
				//levelEngine.applyZoomPosition();
				/*
				var tbb = levelEngine.svg.getBBox();
				console.log(levelEngine.svg.clientHeight);
				var rctn = document.getElementById("rctn");
				var tbb = rctn.getBBox();
				console.log(levelEngine.translateX,levelEngine.translateY,levelEngine.translateZ,' - ');
				rctn.setAttribute("x", ''+(-levelEngine.translateX)+"px");
				rctn.setAttribute("y", ''+(-levelEngine.translateY)+"px");
				rctn.setAttribute("width", ''+(levelEngine.svg.clientWidth*levelEngine.translateZ)+"px");
				rctn.setAttribute("height", ''+(levelEngine.svg.clientHeight*levelEngine.translateZ)+"px");
				 */
				//console.log(levelEngine.translateX,levelEngine.translateY,levelEngine.translateZ);
				//console.log(1,levelEngine.childExists('tstscell') );
				console.log(new Date());
				levelEngine.clearUselessDetails(); //-levelEngine.translateX,-levelEngine.translateY,levelEngine.svg.clientWidth*levelEngine.translateZ,levelEngine.svg.clientHeight*levelEngine.translateZ);
				//console.log(2,levelEngine.childExists('tstscell') );
				console.log('start',new Date());
				var cm = levelEngine.tapSize;
				var cntr=0;
				for (var x = 0; x < 70; x++) {
					for (var y = 0; y < 90; y++) {
						var g = levelEngine.rakeGroup('t'+x+'x'+y, x * cm, y * cm, 0.5 * cm, 0.5 * cm);
						//console.log(3,levelEngine.childExists('tstscell') );
						//console.log(g, levelEngine.childExists('tstscell') );
						if (g) {
							levelEngine.tileRectangle(g, x+'cm', y+'cm', '0.5cm', '0.5cm', 'cell');
							cntr++;
						}
					}
				}
				console.log(cntr,new Date());
			}
			
		</script>
	</body>
</html>
